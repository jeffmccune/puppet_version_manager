#! /bin/bash
#
# Minimal version manager using environment variables.
#
# Everything uses bash substring replacement.  See
# http://tldp.org/LDP/abs/html/string-manipulation.html#SUBSTRREPL00 for more
# information.
#
# The substitutions used are:
# %rv = Ruby, version, e.g. 1.9.3-p327
# %gv = Gemset name, e.g. dev

PVM_PATH="/opt/puppet/versions/bin:/opt/puppet/versions/ruby/%rv/bin:/opt/puppet/versions/ruby/%rv/gemsets/%gv/bin:/opt/puppet/versions/ruby/%rv/gemsets/global/bin:${PATH}"

: ${PVM_RUBY_VERSION:=1.9.3-p327}
: ${PVM_GEMSET:=dev}

newpath="${PVM_PATH}"
newpath="${newpath//%rv/$PVM_RUBY_VERSION}"
newpath="${newpath//%gv/$PVM_GEMSET}"
echo PVM_RUBY_VERSION="'${PVM_RUBY_VERSION}'"
echo export PATH="'${newpath}'"
echo export GEM_PATH="'/opt/puppet/versions/ruby/${PVM_RUBY_VERSION}/gemsets/global'"
echo export GEM_HOME="'/opt/puppet/versions/ruby/${PVM_RUBY_VERSION}/gemsets/${PVM_GEMSET}'"

if [ -z "$PVM_NO_PROMPT" ]; then
  echo "PS1=\"(${PVM_RUBY_VERSION} ${PVM_GEMSET})\$PS1\""
fi
